{"ast":null,"code":"var _jsxFileName = \"/Users/abhinavprasad/Desktop/ai-face-detection/src/App.js\",\n    _s = $RefreshSig$();\n\nimport { useRef, useEffect, useState } from 'react';\nimport './App.css';\nimport * as faceapi from \"face-api.js\";\nimport { FaceExpressions } from 'face-api.js';\nimport $ from 'jquery';\nimport express from \"express\";\nimport fetch from \"node-fetch\"; // new faceapi.TinyFaceDetectorOptions()\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const app = express();\n  let number = 0;\n  let client_id = '42637a421e564dffacf392cd0fef3df6';\n  let client_Secret = '9fba64c6a89d45539af2fe64ac3fc37c';\n  const [accessToken, setaccessToken] = useState(\"\");\n  const videoRef = useRef();\n  const canvasRef = useRef();\n\n  var express = require('express');\n\n  var request = require('request');\n\n  var cors = require('cors'); // var querystring = require('querystring');\n\n\n  app.get(\"/authorize\", (req, res) => {\n    var auth_params = new URLSearchParams({\n      response_type: \"code\",\n      client_id: \"42637a421e564dffacf392cd0fef3df6\",\n      scope: \"\",\n      redirect_uri: \"http://localhost:3001/callback\"\n    });\n    res.redirect(\"https://accounts.spotify.com/authorize?\" + auth_params.toString());\n  });\n  app.get(\"/callback\", (req, res) => {\n    const code = req.query.code;\n    console.log(code);\n  }); // useEffect(() => {\n  //   var auth_params = {\n  //     method: 'POST',\n  //     headers: {\n  //       'Content-Type' : 'application/x-www-form-urlencoded'\n  //     },\n  //     body: 'grant_type=client_credentials&client_id=' + client_id + '&client_secret=' + client_Secret\n  //   }\n  //   fetch('https:/accounts.spotify.com/api/token', auth_params)\n  //   .then(result => result.json())\n  //   .then(data => console.log(data))\n  //   .then(data => setaccessToken(data.access_token))\n  // },[])\n\n  useEffect(() => {\n    startVideo();\n    videoRef && loadModels();\n  }, []);\n\n  const loadModels = () => {\n    Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri('/models'), faceapi.nets.faceLandmark68Net.loadFromUri('/models'), faceapi.nets.faceRecognitionNet.loadFromUri('/models'), faceapi.nets.faceExpressionNet.loadFromUri('/models')]).then(() => {\n      faceDetection();\n    });\n  };\n\n  const startVideo = () => {\n    navigator.mediaDevices.getUserMedia({\n      video: true\n    }).then(currentStream => {\n      videoRef.current.srcObject = currentStream;\n    }).catch(err => {\n      console.error(err);\n    });\n  };\n\n  const faceDetection = async () => {\n    setInterval(async () => {\n      if (number == 1) {\n        return;\n      }\n\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n      let emotions_displayed = detections[0].expressions;\n\n      if (emotions_displayed != undefined) {\n        number++;\n      }\n\n      let max_emotion = 0;\n      let final_emotion = \"\";\n\n      for (const [key, value] of Object.entries(emotions_displayed)) {\n        if (value > max_emotion) {\n          max_emotion = value;\n          final_emotion = key;\n        }\n      }\n\n      console.log(final_emotion + ':' + max_emotion);\n      canvasRef.current.innerHtml = faceapi.createCanvasFromMedia(videoRef.current);\n      faceapi.matchDimensions(canvasRef.current, {\n        width: 940,\n        height: 650\n      });\n      const resized = faceapi.resizeResults(detections, {\n        width: 940,\n        height: 650\n      });\n      faceapi.draw.drawDetections(canvasRef.current, resized);\n      faceapi.draw.drawFaceLandmarks(canvasRef.current, resized);\n      faceapi.draw.drawFaceExpressions(canvasRef.current, resized);\n      let number_of_playlists = 5;\n      let selected_playlist = Math.floor(Math.random() * number_of_playlists);\n      var search_params = {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + accessToken\n        }\n      };\n      var get_playlist = await fetch('https://api.spotify.com/v1/search?q=' + max_emotion + '&type=playlist&limit=5', search_params).then(response => response.json()).then(data => console.log(data)); // fetch(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\", {\n      //   method: 'GET',\n      // })\n      // fetch(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\")\n      // $.get(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\", function(data) {\n      //                           console.log(data)\n      //                           // playlist = data.playlists.items[selectedPlaylist].external_urls.spotify;\n      //                           // window.open(playlist, '_blank');\n      //                       })\n    }, 1000);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \" AI FACE DETECTION\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"  \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"app__video\",\n      children: /*#__PURE__*/_jsxDEV(\"video\", {\n        crossOrigin: \"anonymous\",\n        ref: videoRef,\n        autoPlay: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      width: \"940\",\n      height: \"650\",\n      className: \"app__canvas\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"E0hWs6tNYPX/MgiBqLoQOtXiSOE=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/abhinavprasad/Desktop/ai-face-detection/src/App.js"],"names":["useRef","useEffect","useState","faceapi","FaceExpressions","$","express","fetch","App","app","number","client_id","client_Secret","accessToken","setaccessToken","videoRef","canvasRef","require","request","cors","get","req","res","auth_params","URLSearchParams","response_type","scope","redirect_uri","redirect","toString","code","query","console","log","startVideo","loadModels","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","then","faceDetection","navigator","mediaDevices","getUserMedia","video","currentStream","current","srcObject","catch","err","error","setInterval","detections","detectAllFaces","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","emotions_displayed","expressions","undefined","max_emotion","final_emotion","key","value","Object","entries","innerHtml","createCanvasFromMedia","matchDimensions","width","height","resized","resizeResults","draw","drawDetections","drawFaceLandmarks","drawFaceExpressions","number_of_playlists","selected_playlist","Math","floor","random","search_params","method","headers","get_playlist","response","json","data"],"mappings":"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","sourcesContent":["import { useRef, useEffect, useState } from 'react';\nimport './App.css';\nimport * as faceapi from \"face-api.js\";\nimport { FaceExpressions } from 'face-api.js';\nimport $ from 'jquery';\nimport express from \"express\";\nimport fetch from \"node-fetch\";\n// new faceapi.TinyFaceDetectorOptions()\n\nfunction App() {\n\n  const app = express();\n\n  let number = 0;\n  let client_id = '42637a421e564dffacf392cd0fef3df6';\n  let client_Secret = '9fba64c6a89d45539af2fe64ac3fc37c';\n  const [accessToken, setaccessToken] = useState(\"\")\n\n  const videoRef = useRef();\n  const canvasRef = useRef();\n\n  var express = require('express');\n  var request = require('request');\n  var cors = require('cors');\n  // var querystring = require('querystring');\n\n  app.get(\"/authorize\", (req,res) => {\n\n    var auth_params = new URLSearchParams({\n      response_type : \"code\",\n      client_id : \"42637a421e564dffacf392cd0fef3df6\",\n      scope : \"\",\n      redirect_uri : \"http://localhost:3001/callback\",\n    })\n\n    res.redirect(\"https://accounts.spotify.com/authorize?\" + auth_params.toString());\n  })\n\n  app.get(\"/callback\", (req,res) => {\n\n    const code = req.query.code;\n    console.log(code);\n  })\n\n  // useEffect(() => {\n    \n  //   var auth_params = {\n  //     method: 'POST',\n  //     headers: {\n  //       'Content-Type' : 'application/x-www-form-urlencoded'\n  //     },\n  //     body: 'grant_type=client_credentials&client_id=' + client_id + '&client_secret=' + client_Secret\n  //   }\n  //   fetch('https:/accounts.spotify.com/api/token', auth_params)\n  //   .then(result => result.json())\n  //   .then(data => console.log(data))\n  //   .then(data => setaccessToken(data.access_token))\n\n  // },[])\n\n  \n\n  useEffect(() => {\n    startVideo();\n\n    videoRef && loadModels();\n\n  }, []);\n  \n    const loadModels = () => {\n      Promise.all([\n        faceapi.nets.tinyFaceDetector.loadFromUri('/models'),\n        faceapi.nets.faceLandmark68Net.loadFromUri('/models'),\n        faceapi.nets.faceRecognitionNet.loadFromUri('/models'),\n        faceapi.nets.faceExpressionNet.loadFromUri('/models'),\n      ]).then(() => {\n        faceDetection();\n      })\n    };\n\n  const startVideo = () => {\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then((currentStream) => {\n        videoRef.current.srcObject = currentStream;\n      })\n      .catch((err) => {\n        console.error(err)\n      });\n  }\n\n  const faceDetection = async () => {\n    setInterval(async() => {\n      if (number==1)\n      {\n        return\n      }\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n      let emotions_displayed = detections[0].expressions;\n      if (emotions_displayed != undefined)\n      {\n        number++;\n      }\n      let max_emotion = 0\n      let final_emotion = \"\"\n      for (const [key,value] of Object.entries(emotions_displayed))\n      {\n        if (value > max_emotion)\n        {\n          max_emotion = value\n          final_emotion = key\n        }\n      }\n      console.log(final_emotion + ':' + max_emotion)\n  \n      canvasRef.current.innerHtml = faceapi.createCanvasFromMedia(videoRef.current);\n      faceapi.matchDimensions(canvasRef.current, {\n        width: 940,\n        height: 650,\n      })\n\n      const resized = faceapi.resizeResults(detections, {\n        width: 940,\n        height: 650,\n      });\n\n      faceapi.draw.drawDetections(canvasRef.current, resized)\n      faceapi.draw.drawFaceLandmarks(canvasRef.current, resized)\n      faceapi.draw.drawFaceExpressions(canvasRef.current, resized)\n\n      let number_of_playlists = 5\n      let selected_playlist = Math.floor(Math.random() * number_of_playlists)\n\n      var search_params = {\n          method: 'GET',\n          headers: {\n            'Content-Type' : 'application/json',\n            'Authorization' : 'Bearer ' + accessToken\n          }\n      }\n    \n      var get_playlist = await fetch('https://api.spotify.com/v1/search?q=' + max_emotion + '&type=playlist&limit=5', search_params)\n      .then(response => response.json())\n      .then(data => console.log(data))\n      \n\n      // fetch(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\", {\n      //   method: 'GET',\n\n      // })\n\n      // fetch(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\")\n\n      // $.get(\"https://api.spotify.com/v1/search?q=\" + final_emotion + \"&type=playlist&limit=5\", function(data) {\n      //                           console.log(data)\n      //                           // playlist = data.playlists.items[selectedPlaylist].external_urls.spotify;\n      //                           // window.open(playlist, '_blank');\n      //                       })\n\n    }, 1000)\n  }\n\n  return (\n    <div  className=\"app\">\n      <h1> AI FACE DETECTION</h1>\n      <h1>  </h1>\n      <div className='app__video'>\n        <video crossOrigin='anonymous' ref={videoRef} autoPlay ></video>\n      </div>\n        <canvas ref={canvasRef} width=\"940\" height=\"650\" className='app__canvas' />\n      \n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}